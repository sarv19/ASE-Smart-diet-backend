<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.group42.dao.IngredientMapper">

    <select id="selectIngredientsByPreference" resultType="com.group42.model.vo.IngredientVO">
        SELECT i.ingredient_id,
               ingredient_name,
               description,
               calories,
               fat,
               carbohydrate,
               protein,
               sodium
        FROM ingredient i
    </select>

    <select id="selectRecommendByPreference" resultType="com.group42.model.entity.Ingredient">
        select i.ingredient_id,
               type_id,
               ingredient_name,
               description,
               calories,
               fat,
               carbohydrate,
               protein,
               sodium
        from ingredient i
                 right join (select ANY_VALUE(ingredient_id) as ingredient_id
                             from ingredient i
                             where ingredient_id not in
                                   (select ingredient_id
                                    from eating_preference
                                    where user_id = #{userId}
                                      and is_like is false)
                             group by type_id
                             ORDER BY RAND()) tmp on i.ingredient_id = tmp.ingredient_id
    </select>
</mapper>
